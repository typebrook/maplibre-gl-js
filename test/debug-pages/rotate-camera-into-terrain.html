<!DOCTYPE html>
<html>
  <head>
    <title>MapLibre GL JS debug page for terrian</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <link rel="stylesheet" href="../../dist/maplibre-gl.css" />
    <style>
      body {
        margin: 0;
        padding: 0;
      }

      html,
      body,
      #map {
        height: 100%;
      }
      #overlay {
          position: absolute;
          top: 0px;
          padding: 1rem;
          background-color: white;
      }
      .svg {
          position: absolute;
          width: 30px;
          height: 30px;
          top: 0px;
          left: 0px;
      }
    </style>
  </head>

  <body>
    <div id="map"></div>
    <div id="overlay">
    <svg id="camera" class="svg" version="1.1" width="300" height="200" xmlns="http://www.w3.org/2000/svg">
        <circle cx="15" cy="15" r="10" fill="red" />
    </svg>
    <svg id="center" class="svg" version="1.1" width="300" height="200" xmlns="http://www.w3.org/2000/svg">
        <circle cx="15" cy="15" r="10" fill="blue" />
    </svg>

    <script src="../../dist/maplibre-gl-dev.js"></script>
    <script>
      var map = (window.map = new maplibregl.Map({
          container: 'map',
          zoom: 15.22,
          center: [6.556991, 61.288471],
          pitch: 68,
          hash: true,
          style: {
              version: 8,
              sources: {
                  sat: {
                      type: 'raster',
                      tiles: [
                          'https://mt0.google.com/vt/lyrs=s&hl=en&x={x}&y={y}&z={z}',
                      ],
                      tileSize: 256,
                      maxzoom: 20,
                  },
                  terrainSource: {
                      type: 'raster-dem',
                      tiles: [
                          'https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png',
                      ],
                      encoding: 'terrarium',
                      tileSize: 256,
                      maxzoom: 15,
                  }
              },
              layers: [{id: 'sat', type: 'raster', source: 'sat'},],
              terrain: {
                  source: 'terrainSource',
                  exaggeration: 1,
              },
          },
          maxZoom: 18,
          maxPitch: 85,
      }));

      function rotateCamera(timestamp) {
          // clamp the rotation between 0 -360 degrees
          // Divide timestamp by 100 to slow rotation to ~10 degrees / sec
          map.rotateTo((timestamp / 100) % 360, { duration: 0 });
          console.log(timestamp)
          // Request the next frame of the animation.
              requestAnimationFrame(rotateCamera);

          let cameraPoint = map.transform.getCameraPoint();
          let centerPoint = map.transform.centerPoint;
          const svgCamera = document.getElementById('camera');
          svgCamera.style.left = `${cameraPoint.x.toString()}px`;
          svgCamera.style.top = `${cameraPoint.y.toString()}px`;

          const svgCenter = document.getElementById('center');
          svgCenter.style.left = `${centerPoint.x.toString()}px`;
          svgCenter.style.top = `${centerPoint.y.toString()}px`;
      }

      map.on('load', function () {
          // Start the animation.
          rotateCamera(0);
      });

      map.addControl(
          new maplibregl.NavigationControl({
              visualizePitch: true,
              showZoom: true,
              showCompass: true,
          })
      );

      map.addControl(
          new maplibregl.TerrainControl({
              source: 'terrainSource',
              exaggeration: 1,
          })
      );
    </script>
  </body>
</html>
